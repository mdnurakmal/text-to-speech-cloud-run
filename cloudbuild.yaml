steps:
  - id: "build image"
    name: "gcr.io/cloud-builders/docker"
    args:
      [
        "build",
        "-t",
        "gcr.io/${PROJECT_ID}/${_SERVICE_NAME}",
        "${_SERVICE_FOLDER}",
      ]
    env:
    - 'GOOGLE_ENTRYPOINT="exec gunicorn --bind :$PORT --workers 1 --threads 8 app:app"'

  - id: "push image"
    name: "gcr.io/cloud-builders/docker"
    args: ["push", "gcr.io/${PROJECT_ID}/${_SERVICE_NAME}"]

options:
  logStreamingOption: STREAM_ON

substitutions:
  _SERVICE_FOLDER: text-speech
  _SERVICE_NAME: text-to-speech

images:
  - "gcr.io/${PROJECT_ID}/${_SERVICE_NAME}"
