{ 
    
    "build": {
        "skip": true
        },
    "hooks": {
        "prebuild": {
            "commands": [
                "echo $PWD",
                "sudo wget 'https://releases.hashicorp.com/terraform/1.0.6/terraform_1.0.6_linux_amd64.zip'",
                "sudo unzip terraform_1.0.6_linux_amd64.zip",
                "sudo rm /usr/local/bin/terraform",
                "sudo ln -sf $HOME/terraform /usr/local/bin/terraform",
                "gcloud config set project $GOOGLE_CLOUD_PROJECT",
                "gcloud config set run/region $GOOGLE_CLOUD_REGION",
                "gsutil mb gs://text-to-speech-cloud-run-bucket",

                "cd Init_TF && terraform init",
                "cd Init_TF && terraform import google_storage_bucket.text-to-speech-cloud-run-bucket text-to-speech-cloud-run-bucket",
                "cd Init_TF && terraform apply -auto-approve",

                "gcloud builds submit -q",
                "docker pull gcr.io/${GOOGLE_CLOUD_PROJECT}/text-to-speech-cloud-run",
                "cd Prov_TF && terraform init",
                "cd Prov_TF && terraform apply -auto-approve -input=false"
            ]
        }
    }
}